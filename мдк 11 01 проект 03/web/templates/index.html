{% extends "base.html" %}

{% block content %}
<div class="card">
    <form method="post">
        <button class="btn" type="submit">Запустить 50 тестов</button>
    </form>
    <p style="margin-top: 0.5rem;">Последний отчёт: {{ format_ts(report.started_at) if report else 'ещё не запускалось' }}</p>
</div>

{% if report %}
    <div class="card">
        <h2>Сводная статистика</h2>
        <div class="stats-grid">
            <div class="stat"><strong>Всего</strong><br>{{ report.stats.total }}</div>
            <div class="stat"><strong>Успешно</strong><br>{{ report.stats.passed }}</div>
            <div class="stat"><strong>Провалы</strong><br>{{ report.stats.failed }}</div>
            <div class="stat"><strong>Ошибки</strong><br>{{ report.stats.errors }}</div>
            <div class="stat"><strong>Пропуски</strong><br>{{ report.stats.skipped }}</div>
            <div class="stat"><strong>Длительность</strong><br>{{ '%.3f'|format(report.stats.duration) }} с</div>
        </div>
    </div>

    <div class="card">
        <h2>Статистика по группам</h2>
        <table>
            <thead>
            <tr>
                <th>Группа</th>
                <th>Успешно</th>
                <th>Провалы</th>
                <th>Ошибки</th>
                <th>Пропуски</th>
            </tr>
            </thead>
            <tbody>
            {% for group, stats in report.stats.per_group.items() %}
                <tr>
                    <td>{{ group }}</td>
                    <td>{{ stats.passed }}</td>
                    <td>{{ stats.failed }}</td>
                    <td>{{ stats.errors }}</td>
                    <td>{{ stats.skipped }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="card">
        <h2>Подробные результаты</h2>
        <table>
            <thead>
            <tr>
                <th>#</th>
                <th>Группа</th>
                <th>Название</th>
                <th>Статус</th>
                <th>Длительность (с)</th>
                <th>Сообщение</th>
            </tr>
            </thead>
            <tbody>
            {% for result in report.results %}
                {% set css = {
                    'passed': 'status-pass',
                    'failed': 'status-fail',
                    'errors': 'status-error',
                    'skipped': 'status-skip'
                }[result.status] %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ result.group }}</td>
                    <td>{{ result.name }}</td>
                    <td class="{{ css }}">{{ result.status }}</td>
                    <td>{{ '%.4f'|format(result.duration) }}</td>
                    <td>{{ result.message or '—' }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div>
{% else %}
    <div class="card">
        <p>Запустите тесты, чтобы увидеть отчёт.</p>
    </div>
{% endif %}
{% endblock %}


